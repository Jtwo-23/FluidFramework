# Copyright (c) Microsoft Corporation and contributors. All rights reserved.
# Licensed under the MIT License.

# download-pipeline-artifact pipeline

parameters:
- name: pipelineDefinition
  type: string

- name: branchName
  default: ''
  type: string
    
steps:
# Download the api-extractor outputs
# Setting allowPartiallySucceededBuilds to true so that builds which complete with 
# warnings will be included as well. This is especially needed for archived builds
# with warnings such as driver-definitions and core-interfaces
- script: |
    if [ -z "${{ parameters.branchName }}" ]; then
      newVar=$(Build.SourceBranch)
    else
      newVar="${{ parameters.branchName }}"
    fi
    echo "newVar is now set to: $newVar"
    echo "##vso[task.setvariable variable=myNewVariable]$newVar"
    echo pipelineName: ${{ parameters.pipelineDefinition }}
    echo SourceBranchName: ${{ parameters.branchName }}
    echo branch used: ${{ variables.myNewVariable }}


- task: DownloadPipelineArtifact@2
  inputs:
    buildType: specific
    project: internal
    pipeline: ${{ parameters.pipelineDefinition }}
    buildVersionToDownload: latestFromBranch
    branchName: ${{ variables.branchName }}
    artifact: _api-extractor-temp
    allowPartiallySucceededBuilds: true