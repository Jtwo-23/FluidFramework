# Copyright (c) Microsoft Corporation and contributors. All rights reserved.
# Licensed under the MIT License.

# download-pipeline-artifact pipeline

parameters:
- name: pipelineDefinition
  type: string

- name: branchName
  default: ''
  type: string
    
steps:
# Download the api-extractor outputs
# Setting allowPartiallySucceededBuilds to true so that builds which complete with 
# warnings will be included as well. This is especially needed for archived builds
# with warnings such as driver-definitions and core-interfaces
- script: |
    if [ "${{ parameters.branchName }}" -eq "" ]; then
      $val = "$(Build.SourceBranch)"
    else
      $val = "${{ parameters.branchName }}"
    fi
    echo "##vso[task.setvariable variable=branchName]$val"
    echo pipelineName: ${{ parameters.pipelineDefinition }}
    echo SourceBranchName: ${{ parameters.branchName }}



- task: DownloadPipelineArtifact@2
  inputs:
    buildType: specific
    project: internal
    pipeline: ${{ parameters.pipelineDefinition }}
    buildVersionToDownload: latestFromBranch
    branchName: ${{ variables.branchName }}
    artifact: _api-extractor-temp
    allowPartiallySucceededBuilds: true